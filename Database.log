DROP DATABASE IF EXISTS FindLearnEducationCeneter;
CREATE DATABASE IF NOT EXISTS FindLearnEducationCeneter;
SHOW DATABASES;
USE FindLearnEducationCeneter;



CREATE TABLE IF NOT EXISTS Employee(
	EmpId VARCHAR(10),
	EmpName VARCHAR(50),
	EmpDOB DATE,
	EmpAddress VARCHAR(20),
	PhoneNumber INT(10),
	CONSTRAINT PRIMARY KEY(EmpId)
);



CREATE TABLE IF NOT EXISTS Teacher(
	TeacherId VARCHAR(10),
	TeacherName VARCHAR(50),
	TeahcerAddress VARCHAR(20),
	PhoneNumber INT(10),
	Email VARCHAR(50),
	CONSTRAINT PRIMARY key(TeacherId)
);



CREATE TABLE IF NOT EXISTS EmployeeSalary(
	SalaryId VARCHAR(10),
	EmpId VARCHAR(10),
	payDate DATE,
	VALUE DOUBLE,
	CONSTRAINT PRIMARY KEY(SalaryId),
	CONSTRAINT FOREIGN KEY(EmpId) REFERENCES Employee(EmpId)
		ON DELETE CASCADE ON UPDATE CASCADE
);



CREATE TABLE IF NOT EXISTS TeacherSalary(
	SalaryId VARCHAR(10),
	TeacherId VARCHAR(10),
	payDate DATE,
	VALUE DOUBLE,
	CONSTRAINT PRIMARY KEY(SalaryId),
	CONSTRAINT FOREIGN KEY(TeacherId) REFERENCES Teacher(TeacherId)
		ON DELETE CASCADE ON UPDATE CASCADE
);



CREATE TABLE IF NOT EXISTS User(
	UserName VARCHAR(15),
	UserPassword VARCHAR(50),
	EmpId VARCHAR(10),
	TeacherId VARCHAR(10),
	CONSTRAINT PRIMARY KEY(UserName),
	CONSTRAINT FOREIGN KEY(TeacherId) REFERENCES Teacher(TeacherId)
		ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT FOREIGN KEY(EmpId) REFERENCES Employee(EmpId)
		ON DELETE CASCADE ON UPDATE CASCADE
	
);



CREATE TABLE IF NOT EXISTS Course(
	CrsId VARCHAR(10),
	CrsName VARCHAR(50),
	Duration INT,
	courseFee DOUBLE,
	CONSTRAINT PRIMARY KEY(CrsId)
);



CREATE TABLE IF NOT EXISTS Subject(
	SubId VARCHAR(10),
	SubName VARCHAR(30),
	CrsId VARCHAR(10),
	CONSTRAINT PRIMARY KEY(SubId),
	CONSTRAINT FOREIGN KEY(CrsId) REFERENCES Course(CrsId)
		ON DELETE CASCADE ON UPDATE CASCADE
);



CREATE TABLE IF NOT EXISTS TeacherSubject(
	SubId VARCHAR(10),
	TeacherId VARCHAR(10),
	CONSTRAINT PRIMARY KEY(SubId , TeacherId),
	CONSTRAINT FOREIGN KEY(SubId) REFERENCES Subject(SubId)
		ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT FOREIGN KEY(TeacherId) REFERENCES Teacher(TeacherId)
		ON DELETE CASCADE ON UPDATE CASCADE
);



CREATE TABLE IF NOT EXISTS Batch(
	BatchId VARCHAR(10),
	BatchName VARCHAR(25),
	CrsId VARCHAR(10),
	BatchYear INT(4),
	BatchSeats INT,
	CONSTRAINT PRIMARY KEY(BatchId),
	CONSTRAINT FOREIGN KEY(CrsId) REFERENCES course(CrsId)
		ON DELETE CASCADE ON UPDATE CASCADE
);



CREATE TABLE IF NOT EXISTS Exam(
	ExamId VARCHAR(10),
	Details VARCHAR(20),
	Duration INT,
	BatchId VARCHAR(10),
	SubId VARCHAR(10),
	CONSTRAINT PRIMARY KEY(ExamId),
	CONSTRAINT FOREIGN KEY(BatchId) REFERENCES Batch(BatchId)
		ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT FOREIGN KEY(SubId) REFERENCES Subject(SubId)
		ON DELETE CASCADE ON UPDATE CASCADE
);



CREATE TABLE IF NOT EXISTS Student(
	StId VARCHAR(10),
	StName VARCHAR(50),
	StAddress VARCHAR(20),
	StDOB DATE,
	PhoneNumber INT(10),
	StEmail VARCHAR(50),
	CONSTRAINT PRIMARY KEY(StId)
);



CREATE TABLE IF NOT EXISTS StudentBatch(
	StId VARCHAR(10),
	BatchId VARCHAR(10),
	CONSTRAINT PRIMARY KEY(StId , BatchId),
	CONSTRAINT FOREIGN KEY(StId) REFERENCES Student(StId)
		ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT FOREIGN KEY(BatchId) REFERENCES Batch(BatchId)
		ON DELETE CASCADE ON UPDATE CASCADE
);



CREATE TABLE IF NOT EXISTS Result(
	RstId VARCHAR(10),
	Discription VARCHAR(30),
	Marks INT(3),
	ExamId VARCHAR(10),
	StId VARCHAR(10),
	CONSTRAINT PRIMARY KEY(RstId),
	CONSTRAINT FOREIGN KEY(ExamId) REFERENCES Exam(ExamId)
		ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT FOREIGN KEY(StId) REFERENCES Student(StId)
		ON DELETE CASCADE ON UPDATE CASCADE
);


DROP TABLE payment;
CREATE TABLE IF NOT EXISTS Payment(
	PayId VARCHAR(10),
	StId VARCHAR(10),
	CrsId VARCHAR(10),	
	Value DOUBLE,
	CONSTRAINT PRIMARY KEY(PayId),
	CONSTRAINT FOREIGN KEY(StId) REFERENCES Student(StId)
		ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT FOREIGN KEY(CrsId) REFERENCES Course(CrsId)
		ON DELETE CASCADE ON UPDATE CASCADE
);


SHOW TABLES;

INSERT INTO employee VALUES("E001","Sehan","2002.05.07","Matara",0717741721);
INSERT INTO teacher VALUES("T001", "Ranaweera", "Galle",0713469876 , "sehan@gmail.com");

INSERT INTO teachersalary VALUES("S001" , "T001" , "2022-11-28" , 100000);
INSERT INTO employeesalary VALUES("S001" , "E001" , "2022-11-25" , 200000);

INSERT INTO payment VALUES("P0000",NULL,NULL,NULL);



